#!/bin/bash

submenu_tailscale() {
  while true; do
    clear
    echo "===== ğŸ“¡ Tailscale ç®¡ç† ====="
    echo " 1. æ£€æŸ¥æ›´æ–°"
    echo " 2. ç™»å½•çŠ¶æ€"
    echo " 3. æŸ¥çœ‹ç½‘ç»œ (ifconfig)"
    echo " 4. æŸ¥çœ‹å…¬ç½‘æ˜ å°„ (Funnel)"
    echo " 5. tailscale çŠ¶æ€"
    echo " 99. å¸è½½"
    echo " 0. è¿”å›"
    echo ""
    read -p "è¯·é€‰æ‹©æ“ä½œç¼–å·: " choice
    case "$choice" in
      1) docker exec -it tailscale tailscale version; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      2) docker exec -it tailscale tailscale status; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      3) ifconfig; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      4) docker exec -it tailscale tailscale funnel list; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      5) docker exec -it tailscale tailscale status; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      99)
        read -p "âš ï¸ ç¡®è®¤è¦å¸è½½ tailscale å—ï¼Ÿ(y/n): " confirm
        if [[ "$confirm" == "y" ]]; then
          docker rm -f tailscale && rm -rf ~/tailscale-docker
          echo "âœ… å·²å¸è½½ tailscale"
        else
          echo "â å·²å–æ¶ˆ"
        fi
        read -p "æŒ‰å›è½¦ç»§ç»­..."
        ;;
      0) break ;;
      *) echo "âŒ æ— æ•ˆé€‰é¡¹"; read ;;
    esac
  done
}

submenu_openwebui() {
  while true; do
    clear
    echo "===== ğŸŒ Open WebUI ç®¡ç† ====="
    echo " 1. æ£€æŸ¥æ›´æ–°"
    echo " 2. å¯åŠ¨æœåŠ¡"
    echo " 3. åœæ­¢æœåŠ¡"
    echo " 4. æŸ¥çœ‹æ—¥å¿—"
    echo " 99. å¸è½½"
    echo " 0. è¿”å›"
    echo ""
    read -p "è¯·é€‰æ‹©æ“ä½œç¼–å·: " choice
    case "$choice" in
      1) docker pull ghcr.io/open-webui/open-webui:main && echo "âœ… å·²æ›´æ–°"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      2) docker start openwebui && echo "âœ… å·²å¯åŠ¨ Open WebUI"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      3) docker stop openwebui && echo "âœ… å·²åœæ­¢ Open WebUI"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      4) docker logs -f openwebui ;;
      99)
        read -p "âš ï¸ ç¡®è®¤è¦å¸è½½ Open WebUI å—ï¼Ÿ(y/n): " confirm
        if [[ "$confirm" == "y" ]]; then
          docker stop openwebui && docker rm openwebui && docker volume rm openwebui-data
          echo "âœ… Open WebUI å·²å¸è½½"
        else
          echo "â å·²å–æ¶ˆå¸è½½"
        fi
        read -p "æŒ‰å›è½¦ç»§ç»­..."
        ;;
      0) break ;;
      *) echo "âŒ æ— æ•ˆé€‰é¡¹ï¼ŒæŒ‰å›è½¦é‡è¯•..."; read ;;
    esac
  done
}

submenu_ollama() {
  while true; do
    clear
    echo "===== ğŸ¦™ Ollama ç®¡ç† ====="
    echo " 1. æ£€æŸ¥æ›´æ–°"
    echo " 2. æœåŠ¡çŠ¶æ€"
    echo " 3. åœæ­¢æœåŠ¡"
    echo " 4. é‡å¯æœåŠ¡"
    echo " 5. æœåŠ¡æ—¥å¿—"
    echo " 6. æ‹‰å–æ¨¡å‹"
    echo " 7. æ¸…ç†æ¨¡å‹"
    echo " 8. æ¥å£æ£€æŸ¥"
    echo " 99. å¸è½½"
    echo " 0. è¿”å›"
    echo ""
    read -p "è¯·é€‰æ‹©æ“ä½œç¼–å·: " choice
    case "$choice" in
      1) curl -fsSL https://ollama.com/install.sh | sh && echo "âœ… å·²æ›´æ–° Ollama"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      2) systemctl status ollama ; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      3) sudo systemctl stop ollama && echo "âœ… å·²åœæ­¢"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      4) sudo systemctl restart ollama && echo "âœ… å·²é‡å¯"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      5) journalctl -u ollama -e -f ;;
      6) read -p "è¾“å…¥æ¨¡å‹åç§°ï¼ˆå¦‚ llama3:latestï¼‰: " model; ollama pull "$model" ; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      7) ollama rm -a && echo "âœ… æ‰€æœ‰æ¨¡å‹å·²æ¸…ç†"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      8) curl http://localhost:11434/api/tags && echo "âœ… æ¥å£æ­£å¸¸"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      99)
        read -p "âš ï¸ ç¡®è®¤è¦å¸è½½ Ollama å—ï¼Ÿ(y/n): " confirm
        if [[ "$confirm" == "y" ]]; then
          sudo systemctl stop ollama && sudo rm -f /etc/systemd/system/ollama.service
          sudo systemctl daemon-reload
          sudo rm -rf ~/.ollama /usr/local/bin/ollama
          echo "âœ… å·²å¸è½½ Ollama"
        else
          echo "â å·²å–æ¶ˆå¸è½½"
        fi
        read -p "æŒ‰å›è½¦ç»§ç»­..."
        ;;
      0) break ;;
      *) echo "âŒ æ— æ•ˆé€‰é¡¹ï¼ŒæŒ‰å›è½¦é‡è¯•..."; read ;;
    esac
  done
}

submenu_anythingllm() {
  while true; do
    clear
    echo "===== ğŸ“š AnythingLLM ç®¡ç† ====="
    echo " 1. æ£€æŸ¥æ›´æ–°"
    echo " 2. å¯åŠ¨æœåŠ¡"
    echo " 3. åœæ­¢æœåŠ¡"
    echo " 4. ä¿®æ”¹é…ç½®"
    echo " 5. æ¸…é™¤ç¼“å­˜"
    echo " 99. å¸è½½"
    echo " 0. è¿”å›"
    echo ""
    read -p "è¯·é€‰æ‹©æ“ä½œç¼–å·: " choice
    case "$choice" in
      1) cd ~/anything-llm && git pull && echo "âœ… å·²æ›´æ–°"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      2) cd ~/anything-llm && docker compose up -d && echo "âœ… å¯åŠ¨å®Œæˆ"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      3) cd ~/anything-llm && docker compose down && echo "âœ… å·²åœæ­¢"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      4) nano ~/anything-llm/.env ;;
      5) docker system prune -af && echo "âœ… æ¸…ç†å®Œæˆ"; read -p "æŒ‰å›è½¦ç»§ç»­..." ;;
      99)
        read -p "âš ï¸ ç¡®è®¤è¦å¸è½½ AnythingLLM å—ï¼Ÿ(y/n): " confirm
        if [[ "$confirm" == "y" ]]; then
          cd ~ && rm -rf ~/anything-llm
          echo "âœ… AnythingLLM å·²å¸è½½"
        else
          echo "â å·²å–æ¶ˆå¸è½½"
        fi
        read -p "æŒ‰å›è½¦ç»§ç»­..."
        ;;
      0) break ;;
      *) echo "âŒ æ— æ•ˆé€‰é¡¹ï¼ŒæŒ‰å›è½¦é‡è¯•..."; read ;;
    esac
  done
}
